name: Sync README Line

on:
  schedule:
    # 每天凌晨 0 点自动运行（UTC 时间）
    - cron: "0 0 * * *"
  workflow_dispatch:  # 允许手动触发

jobs:
  sync-readme:
    runs-on: ubuntu-latest
    
    permissions:
    contents: write # 赋予写入权限
    
    steps:
      # 步骤 1：克隆你的仓库和对方的仓库
      - name: Checkout your repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.ACTION_TOKEN }}  # 需配置权限 Token

      - name: Clone target repo
        run: |
          git clone https://github.com/toshare5/toshare5.github.io.git temp-repo

      # 步骤 2：提取对方 README 的指定行
      - name: Extract line from target README
        id: extract-line
        run: |
          # 示例：提取第 10 行
          TARGET_LINE=$(sed -n '29p' temp-repo/README.md)
          # 或提取包含特定标记的行（例如 <!-- SYNC_LINE -->）
          # TARGET_LINE=$(grep "<!-- SYNC_LINE -->" temp-repo/README.md)

          # 将内容保存到环境变量
          echo "SYNCED_CONTENT=$TARGET_LINE" >> $GITHUB_ENV

      # 步骤 3：获取网站内 env.SYNCED_CONTENT
      - name: Fetch web content
        run: |
        # 使用 curl 获取网页内容（示例网址）
        curl -sL "$TARGET_LINE" > new_content.txt
        # 清空并覆写 README.md
        echo "" > README.md
        cat new_content.txt >> README.md

      # 步骤 4：提交更改
      - name: Commit changes
       run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add README.md
        git commit -m "Auto-update README from web content"
        git push
